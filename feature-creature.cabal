-- Initial feature-creature.cabal generated by cabal init.  For further
-- documentation, see http://haskell.org/cabal/users-guide/

name:                feature-creature
version:             0.1.0.0
synopsis:            A live editor for Cucumber features
description:         A live editor for Cucumber features
license:             MIT
license-file:        LICENSE
author:              Todd Mohney
maintainer:          toddmohney@gmail.com
build-type:          Simple
data-files:          data/cli/*.txt
cabal-version:       >=1.10

library
  exposed-modules:   Config.Config
                   , CommonCreatures
                   , Data.DirectoryTree
                   , Database.Types
                   , DomainTerms.DomainTerm
                   , Features.Feature
                   , Features.SearchableFeature
                   , Git.Git
                   , Git.Diff
                   , Indexer
                   , Messaging.Job
                   , Messaging.Products
                   , Models
                   , ModelTypes
                   , Network.AMQP.MessageBus
                   , Products.Product
                   , Products.CodeRepository
                   , Retry
                   , UserRoles.UserRole

  build-depends:     aeson
                   , amqp >= 0.13.0 && < 0.14.0
                   , base >= 4.8.1.0 && < 4.8.3.0
                   , bytestring
                   , bloodhound
                   , containers
                   , directory
                   , exceptions
                   , http-client
                   , process
                   , monad-logger
                   , mtl
                   , parsec
                   , persistent
                   , persistent-template
                   , persistent-postgresql
                   , safe
                   , text
                   , time
                   , transformers
                   , vector
                   , lens
                   , retry

  ghc-options:       -Wall
                     -fwarn-unused-matches
                     -fwarn-unused-binds
                     -fwarn-unused-imports
                     -threaded
                     -rtsopts
                     -with-rtsopts=-N

  default-language:  Haskell2010
  hs-source-dirs:    lib
  other-modules:     Config.Internal.DB
                   , Config.Internal.ElasticSearch
                   , Config.Internal.Environment
                   , Config.Internal.Git
                   , Config.Internal.RabbitMQ
                   , Network.AMQP.Internal.Connection
                   , Network.AMQP.Internal.Consumer
                   , Network.AMQP.Internal.Producer
                   , Network.AMQP.Internal.Types

executable feature-creature-web
  build-depends:     aeson
                   , amqp >= 0.13.0 && < 0.14.0
                   , base
                   , bytestring
                   , containers
                   , either
                   , feature-creature
                   , http-client
                   , http-media
                   , http-types
                   , monad-logger
                   , mtl
                   , persistent-postgresql
                   , retry
                   , servant
                   , servant-client
                   , servant-docs
                   , servant-server
                   , text
                   , time
                   , transformers
                   , transformers-compat
                   , wai
                   , wai-cors
                   , wai-extra
                   , warp

  ghc-options:       -Wall
                     -fwarn-unused-matches
                     -fwarn-unused-binds
                     -fwarn-unused-imports
                     -fno-warn-orphans
                     -threaded
                     -rtsopts
                     -with-rtsopts=-N

  default-language:  Haskell2010
  hs-source-dirs:    exe-web-executable
  main-is:           Main.hs
  other-modules:     App
                     AppConfig
                     Documentation
                     MimeTypes
                     Products.DomainTermsAPI
                     Products.FeaturesAPI
                     Products.ProductsAPI
                     Products.UserRolesAPI

executable search-service
  build-depends:   aeson
                   , amqp >= 0.13.0 && < 0.14.0
                   , base
                   , bytestring
                   , feature-creature
                   , lens
                   , mtl
                   , retry
                   , text
                   , transformers

  ghc-options:       -Wall
                     -fwarn-unused-matches
                     -fwarn-unused-binds
                     -fwarn-unused-imports
                     -threaded
                     -rtsopts
                     -with-rtsopts=-N

  default-language:  Haskell2010
  hs-source-dirs:    exe-search-service
  main-is:           Main.hs
  other-modules:     App
                     AppConfig

executable repo-refresher
  build-depends:     base
                   , feature-creature
                   , mtl
                   , parsec
                   , persistent-postgresql
                   , retry
                   , text

  ghc-options:       -Wall
                     -fwarn-unused-matches
                     -fwarn-unused-binds
                     -fwarn-unused-imports
                     -threaded
                     -rtsopts
                     -with-rtsopts=-N

  default-language:  Haskell2010
  hs-source-dirs:    exe-repo-refresher
  main-is:           Main.hs
  other-modules:     App
                   , AppConfig

test-suite feature-creature-test
  type:                exitcode-stdio-1.0
  hs-source-dirs:      test
  main-is:             Spec.hs
  build-depends:       aeson
                     , amqp >= 0.13.0 && < 0.14.0
                     , base
                     , feature-creature
                     , hspec >= 2.2.2 && < 2.3.0
                     , mtl
                     , text
                     , transformers

  ghc-options:         -threaded
                       -rtsopts
                       -with-rtsopts=-N

  default-language:    Haskell2010
  other-modules:       Features.SearchableFeatureSpec
                     , Git.DiffSpec
